---
title: "Economia"
editor: visual
---

# Quais as características econômicas dos municípios?

\[Comentário Tabela 1 - Caio\]

\[Tabela 1 - Vitor\] - Inserir uma tabela com as seguintes colunas:

```{r, eval = FALSE, echo=FALSE, warning=FALSE, message=FALSE}

##------Dev_version
#PIB
pib_municipal <- read_excel("dados/pib_municipal.xls")
# População
pop<- read_excel("E:/Drives compartilhados/Vale do Lítio/bases/0 - POPULAÇÃO REFERÊNCIA/IMRS - 2022 (População Referência)/IMRS2022 - BASE POPULACAO REFERENCIA.xlsx") %>% select(IBGE7, ANO, D_POPT) %>% filter(ANO==c('2010', '2020'))


####---------------------------------------------------------

pib_municipal$IBGE7<- as.character(pib_municipal$IBGE7)

pib_mg<- left_join(pop, pib_municipal,by = c('ANO', 'IBGE7')) %>% 
  select(MUNICIPIO, everything()) %>% janitor::clean_names() 

pib_mg<- pib_mg %>% 
  mutate(ranking_uf = rank(pib_mg$produto_interno_bruto_a_precos_correntes_r_1_000))



tabela01_economia <- pib_mg %>% janitor::clean_names() %>%   select(ibge7,municipio,produto_interno_bruto_a_precos_correntes_r_1_000, produto_interno_bruto_per_capita_a_precos_correntes_r_1_00, ranking_uf, atividade_com_maior_valor_adicionado_bruto, atividade_com_segundo_maior_valor_adicionado_bruto, atividade_com_terceiro_maior_valor_adicionado_bruto) %>% 
  filter(ibge7 %in% municipios_vale) 

saveRDS(tabela01_economia, 'tabela01_economia.rds')

```

```{r, echo=FALSE, warning=FALSE, message=FALSE}


#--------------------------------tabela01_economia
library(gt)
library(tidyverse)
library(readxl)

municipios_vale <- c(
  3103405,  # Araçuaí
  3112307,  # Capelinha
  3119500,  # Coronel Murta
  3133303,  # Itaobim
  3134004,  # Itinga
  3139201,  # Malacacheta
  3141405,  # Medina
  3141801,  # Minas Novas
  3148707,  # Pedra Azul
  3168606,  # Teófilo Otoni
  3169703,  # Turmalina
  3156502,  # Rubelita
  3171600,  # Virgem da Lapa
  3157005  # Salinas
)

 tabela01_economia <- readRDS("dados/tabela01_economia.rds")

tabela01_economia %>% gt() %>%
  tab_header(
    title = " Indicadores Econômicos",
    subtitle = md("Vale do Lítio")
  )%>%
  opt_align_table_header(align = "left") %>%
  tab_stubhead(label = md("Region and <br />IAP Type")) %>%
  tab_style(
    style = cell_text(size = "smaller"),
    locations = cells_body()
  )  %>% #rótulo
  opt_table_font(font = google_font(name = "Karla")) %>% 
  tab_options(data_row.padding = px(6),
              heading.align = 'left',
              column_labels.background.color = 'dodgerblue4',
              heading.title.font.size = px(26)) %>% 
  tab_style(
    style = cell_text(
      color = 'dodgerblue4', 
      weight = 'bold', 
      font = google_font('Merriweather')
    ),
    locations = cells_title(groups = 'title')
  ) %>%
  cols_label(
    ibge7 = "Código IBGE",
    municipio = 'Município',
    produto_interno_bruto_a_precos_correntes_r_1_000 = 'PIB',
    produto_interno_bruto_per_capita_a_precos_correntes_r_1_00 = 'PIB per capita',
    ranking_uf = 'Ranking Estadual',
    atividade_com_maior_valor_adicionado_bruto = 'Primeira atividade mais importante',
    atividade_com_segundo_maior_valor_adicionado_bruto = 'Segunda atividade mais importante',
    atividade_com_terceiro_maior_valor_adicionado_bruto = 'Terceira atividade mais importante'
  )

```

-   Município

-   PIB 2020

-   PIB per capita 2020

-   Posição ranking PIB 2020

-   Primeira atividade mais importante

-   Segunda atividade mais importante

-   Terceira atividade mais importante

\[Comentario Gráfico 1 - Caio\]

\[Gráfico 1 - Vitor\] - Inserir gráfico de barras com distribuição das atividades (va agropecuária, industria, serviços e administração pública) 2010 e 2020

-   Município

```{r, eval = FALSE,echo=FALSE, warning=FALSE, message=FALSE}

##Dev_version
dados<- left_join(pop, pib_municipal) %>% select(1:2, 4:12)

tabela02_economia <- dados%>% 
 rename(va_agro = 4,
         va_ind = 5,
         va_serv =6,
        va_adm = 7,
         pib = 10,
         pib_p_capta = 11)

saveRDS(tabela02_economia, 'tabela02_economia.rds')
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}


#----------------------tabela02economia
# Defina as opções para evitar notação científica
options(scipen = 999)

tabela02_economia <- readRDS("dados/tabela02_economia.rds")


# Selecione apenas as colunas relevantes (atividades) e reformule os dados
dados_plot <- tabela02_economia %>%   filter(IBGE7 %in% municipios_vale) %>% 
  select(ANO, MUNICIPIO, va_agro, va_ind, va_serv, va_adm) %>%
  pivot_longer(cols = starts_with("va_"), names_to = "Atividade", values_to = "Valor")

# Crie o gráfico empilhado
grafico <- ggplot(dados_plot, aes(x = MUNICIPIO, y = Valor, fill = Atividade)) +
  geom_bar(stat = "identity") +
  labs(title = "Distribuição das Atividades por Município e Ano",
       x = "Município",
       y = "Valor") +
  scale_fill_brewer(palette = "Set1") +  # Escolha uma paleta de cores
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Exiba o gráfico
print(grafico)



```

\[Tabela 2- Vitor\] - Inserir uma tabela com as seguintes colunas:

-   Município

-   Empregaodos no setor formal

-   Empregados no setor formal - extrativa mineral

-   Percentual de empregados na indústria extrativa

-   indústria da construção

```{r, eval = FALSE, echo=FALSE, warning=FALSE, message=FALSE}

##dev_version
tabela03_economia<- emp_renda %>%  filter(IBGE7 %in% municipios_vale) %>% left_join( df_nome) %>%
  select(IBGE7, Municipio, everything())

saveRDS(tabela03_economia, 'tabela03_economia.rds')


```

```{r, echo=FALSE, warning=FALSE, message=FALSE}


#----------------------tabela03economia

tabela03_economia <- readRDS("dados/tabela03_economia.rds")

tabela03_economia  %>% select(-R_EMPRSFIC) %>% 
  mutate(tx_emp_ext = R_EMPRSFMI/R_EMPRSF) %>% 
  gt() %>% 
  tab_header(
    title = "Composição do Emprego",
  )%>%
  opt_align_table_header(align = "left") %>%
  tab_stubhead(label = md("Region and <br />IAP Type")) %>%
  tab_style(
    style = cell_text(size = "smaller"),
    locations = cells_body()
  )  %>% #rótulo
  opt_table_font(font = google_font(name = "Karla")) %>% 
  tab_options(data_row.padding = px(6),
              heading.align = 'left',
              column_labels.background.color = 'dodgerblue4',
              heading.title.font.size = px(26)) %>% 
  tab_style(
    style = cell_text(
      color = 'dodgerblue4', 
      weight = 'bold', 
      font = google_font('Merriweather')
    ),
    locations = cells_title(groups = 'title')
  ) %>%
  cols_label(
    R_EMPRSF = 'Empregados do setor formal',
    R_EMPRSFMI = 'Empregados setor extrativo mineral',
    tx_emp_ext = 'Percentual de empregados na indústria extrativa'
  )  %>% 
  fmt_number(
    columns = 6,  # Seleciona colunas
    decimals = 2)  # Definir 2 casas decimais 
  





```

\[Comentario Gráfico 2 - Caio\]

\[Gráfico 2 - Vitor\] - Inserir gráfico de linha com total de empregados na indústria extrativa 2010-2021

```{r, eval=FALSE, echo=FALSE, warning=FALSE, message=FALSE}

##dev_version
tabela04_economia <- emp_renda <- readRDS("E:/Drives compartilhados/Vale do Lítio/r_project/versão_git/dados/emp_renda.rds") %>% 
  select(IBGE7,ANO,R_EMPRSFMI) %>% 
  filter(IBGE7 %in% municipios_vale) %>% left_join( df_nome) 

saveRDS(tabela04_economia, 'tabela4_economia.rds')
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}

library(patchwork)
#---------------------tabela04economia
tabela4_economia <- readRDS("dados/tabela4_economia.rds")
# Filtrar os dados para o período de 2010 a 2021
dados_filtrados <- tabela4_economia %>%
  filter(ANO >= 2010 & ANO <= 2021)


# Filtrar dados para municípios com R_EMPRSFMI > 100
dados_maiores <- dados_filtrados %>% filter(R_EMPRSFMI > 110)

# Filtrar dados para municípios com R_EMPRSFMI <= 100
dados_menores <- dados_filtrados %>% filter(R_EMPRSFMI <= 110)

# Maiores
p1 <- ggplot(dados_filtrados, aes(x = ANO, y = R_EMPRSFMI, group = Municipio, color = Municipio)) +
  geom_line(size = .5) +  # Aumentar a espessura das linhas
  geom_point(aes(shape = Municipio), size = 2) +  # Adicionar marcadores
  labs(title = "Evolução do Total de Empregados na Indústria Extrativa (2010-2021)",
       x = "Ano",
       y = "Total de Empregados") +
  theme_minimal() +
  geom_point(size=.5)+
  geom_line()+
  scale_color_manual(values = c("red", "blue", "green", "purple", "orange",
           "pink", "brown", "cyan", "gray", "violet",
           'yellow','black','gold', 'darkblue'))
# Exibir o gráfico
print(p1)




```
